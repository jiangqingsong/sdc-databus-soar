package com.broadtech.databus.soar.controller;

import com.broadtech.databus.soar.common.ResultUtil;
import com.broadtech.databus.soar.service.ScanVulnerabilityService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * @program sdc-databus-soar
 * @description: 漏扫工具controller类
 * @author: 蒋青松
 * @create: 2022/10/10 14:02
 */

@RestController
@RequestMapping("/soar-scan-vulnerability")
public class ScanVulnerabilityController {
    /**
     * public static final String SYS_SCAN_ADD_URL = "/async/sysscan/add?target={target}&user={user}&pwd={pwd}";
     * public static final String WEB_SCAN_ADD_URL = "/async/webscan/add?target={target}&user={user}&pwd={pwd}";
     * public static final String STATUS_URL = "/async/status?&taskid={taskid}&user={user}&pwd={pwd}";
     * public static final String SYS_SCAN_RESULT_URL = "/async/sysscan/query?taskid={taskid}&user={user}&pwd={pwd}";
     * public static final String WEB_SCAN_RESULT_URL = "/async/webscan/query?taskid={taskid}&user={user}&pwd={pwd}";
     */
    @Autowired
    private ScanVulnerabilityService scanVulnerabilityService;

    /**
     * 系统漏洞扫描任务添加
     * @param target
     * @param user
     * @param pwd
     * @return
     */
    @RequestMapping(value = "/sysScanAdd", method = RequestMethod.POST)
    public ResponseEntity<String> sysScanAdd(@RequestParam("target") String target,
                                                       @RequestParam("user") String user,
                                                       @RequestParam("pwd") String pwd)
    {
        String result = scanVulnerabilityService.sysScanAdd(target, user, pwd);
        return new ResponseEntity(ResultUtil.success(result), HttpStatus.OK);
    }

    /**
     * WEB漏洞扫描添加
     * @param target
     * @param user
     * @param pwd
     * @return
     */
    @RequestMapping(value = "/webScanAdd", method = RequestMethod.POST)
    public ResponseEntity<String> webScanAdd(@RequestParam("target") String target,
                                                       @RequestParam("user") String user,
                                                       @RequestParam("pwd") String pwd)
    {
        String result = scanVulnerabilityService.webScanAdd(target, user, pwd);
        return new ResponseEntity(ResultUtil.success(result), HttpStatus.OK);
    }

    /**
     * 进度查询
     * @param taskId
     * @param user
     * @param pwd
     * @return
     */
    @RequestMapping(value = "/getTaskStatus", method = RequestMethod.POST)
    public ResponseEntity<String> getTaskStatus(@RequestParam("taskId") String taskId,
                                                       @RequestParam("user") String user,
                                                       @RequestParam("pwd") String pwd)
    {
        String result = scanVulnerabilityService.getStatus(taskId, user, pwd);
        return new ResponseEntity(ResultUtil.success(result), HttpStatus.OK);
    }

    /**
     * 系统漏洞扫描数据查询
     * @param taskId
     * @param user
     * @param pwd
     * @return
     */
    @RequestMapping(value = "/sysScanResultQuery", method = RequestMethod.POST)
    public ResponseEntity<String> sysScanResultQuery(@RequestParam("taskId") String taskId,
                                                       @RequestParam("user") String user,
                                                       @RequestParam("pwd") String pwd)
    {
        String result = scanVulnerabilityService.sysScanResultQuery(taskId, user, pwd);
        return new ResponseEntity(ResultUtil.success(result), HttpStatus.OK);
    }

    /**
     * WEB漏洞扫描数据查询
     * @param taskId
     * @param user
     * @param pwd
     * @return
     */
    @RequestMapping(value = "/webScanResultQuery", method = RequestMethod.POST)
    public ResponseEntity<String> webScanResultQuery(@RequestParam("taskId") String taskId,
                                                       @RequestParam("user") String user,
                                                       @RequestParam("pwd") String pwd)
    {
        String result = scanVulnerabilityService.webScanResultQuery(taskId, user, pwd);
        return new ResponseEntity(ResultUtil.success(result), HttpStatus.OK);
    }
}
